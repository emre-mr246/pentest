#include <openssl/sha.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define TIME_DIFF_HOURS 1
#define MAX_HASHES 10000

void generate_possible_hashes(const char *username, FILE *file)
{
    time_t current_time;
    struct tm *time_info;
    char time_str[20];
    char lnk[50];
    unsigned char hash[SHA_DIGEST_LENGTH];
    int i = 0;
    int j = 0;

    time(&current_time);
    current_time -= TIME_DIFF_HOURS * 3600;
    while (i < 10) {
        j = 0;
        while (j < MAX_HASHES)
		{
            time(&current_time);
            current_time -= j;
            time_info = localtime(&current_time);
            strftime(time_str, sizeof(time_str), "%Y-%m-%d %H:%M:%S", time_info);
            snprintf(lnk, sizeof(lnk), "%s.%s", time_str, username);
            SHA1((unsigned char *)lnk, strlen(lnk), hash);
            fprintf(file, "Hash: ");
            for (int k = 0; k < SHA_DIGEST_LENGTH; k++)
                fprintf(file, "%02x", hash[k]);
            fprintf(file, "\n");
            j++;
        }
        i++;
    }
}

int main(void)
{
    char username[50];
    char filename[60];
    FILE *file;

    printf("Enter the username: ");
    fgets(username, sizeof(username), stdin);
    username[strcspn(username, "\n")] = '\0';
    if (strlen(username) == 0)
	{
        printf("Error: Username cannot be empty.\n");
        return 1;
    }
    printf("Generating possible SHA-1 hashes for username '%s'...\n", username);
    snprintf(filename, sizeof(filename), "%s.out", username);
    file = fopen(filename, "w");
    if (!file)
	{
        perror("Error opening file");
        return 1;
    }
    generate_possible_hashes(username, file);
    printf("Hashes saved to %s\n", filename);
    fclose(file);
    return (0);
}
